<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Untitled Document</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
</head>

<body>
    <form action="/get">
        <input type="button" value="Przejdź do wyników" onclick="get_result()" id="resultButton" />
        <br />
        <br />
        <canvas id="myChart"></canvas>
    </form>
    <script>
        var ctx = document.getElementById("myChart").getContext("2d");
        var chart = new Chart(ctx, {
            type: "line",
            data: {
                //labels: ["1", "2", "3", "4", "5"],
                datasets: [{
                    label: "Wynik [ms]",
                    backgroundColor: "#ACB382",
                    //data: [446, 480, 460, 490, 500],
                    showLine: false,
                    pointStyle: "circle",
                    pointRadius: 7,
                    pointHoverRadius: 12
                }]
            },
            options: {
                legend: {
                    display: false,
                    position: "bottom"
                },
                scales: {
                    yAxes: [{
                        scaleLabel: {
                            display: true,
                            labelString: "Czas reakcji [ms]",
                            fontSize: 18,
                            fontColor: "#017BFF",
                            fontStyle: "bold"
                        },
                        ticks: {
                            //beginAtZero: true,
                            //max: 600,
                            //stepSize: 50,
                            //min: 10,
                            fontSize: 15,
                            fontColor: "#017BFF",
                            padding: 5
                        }
                    }],
                    xAxes: [{
                        gridLines: {
                            display: true
                        },
                        scaleLabel: {
                            display: true,
                            labelString: "Numer pomiaru",
                            fontSize: 18,
                            fontColor: "#017BFF",
                            fontStyle: "bold"
                        },
                        ticks: {
                            fontSize: 15,
                            fontColor: "#017BFF",
                            padding: 5
                        }
                    }]
                }
            }
        });

        //var label = 1;

        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }


        /*function test() {
            var data = "5,2,1,3,4,5";
            var dataArr = data.split(",");
            console.log(dataArr);
            var ilosc_pomiarow = parseInt(dataArr[0], 10);
            for (var i = 1; i <= ilosc_pomiarow; i++) {
                addData(chart, label, parseInt(dataArr[i], 10));
                label++;
            }
        }*/

        function get_result() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementById("resultButton").style.display =
                        "none";
                    var data = this.responseText;
                    var dataArr = data.split(",");
                    console.log(dataArr);
                    var ilosc_pomiarow = parseInt(dataArr[0], 10);
                    var label = 1;
                    for (var i = 1; i <= ilosc_pomiarow; i++) {
                        addData(chart, label, parseInt(dataArr[i], 10));
                        label++;
                    }
                }
            };
            xhttp.open("GET", "/times", true);
            xhttp.send();
        }

    </script>
</body>

</html>
